<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Giỏ hàng của bạn</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
  <!-- Navbar -->
  <nav>
    <div class="nav-left">
      <a href="index.html">Trang chủ</a>
      <a href="products.html">Sản phẩm</a>
    </div>
    <div class="nav-right">
      <a href="cart.html">Giỏ hàng</a>
    </div>
  </nav>

  <div class="container">
    <h2>Giỏ hàng của bạn</h2>
    <ul id="cartList"></ul>
    <p id="message" class="message error"></p>
  </div>

  <script>
    const token = localStorage.getItem('token');
    fetch('http://localhost:30000/api/cart', {
      method: 'GET',
      headers: { Authorization: `Bearer ${token}` }
    })
    const cartList = document.getElementById('cartList');
    const message = document.getElementById('message');

    if (!token) {
    message.textContent = 'Bạn cần đăng nhập để xem giỏ hàng.';
    } else {
    fetch('http://localhost:30000/api/cart', {
        method: 'GET',
        headers: {
        Authorization: `Bearer ${token}`
        }
    })
    .then(res => {
        if (!res.ok) throw new Error('Không thể lấy giỏ hàng');
        return res.json();
    })
    .then(data => {
        if (data.length === 0) {
        cartList.innerHTML = '<li>Giỏ hàng trống.</li>';
        return;
        }

        cartList.innerHTML = '';
        data.forEach(item => {
        const li = document.createElement('li');
        li.innerHTML = `
            <strong>${item.product_name}</strong><br>
            Số lượng: ${item.quantity}<br>
            <button data-id="${item.id}" class="remove-btn">Xóa</button>
        `;
        cartList.appendChild(li);
        });

        // Gán sự kiện xóa
        document.querySelectorAll('.remove-btn').forEach(button => {
        button.addEventListener('click', () => {
            const cartId = button.dataset.id;
            fetch(`http://localhost:30000/api/cart/${cartId}`, {
            method: 'DELETE',
            headers: { Authorization: `Bearer ${token}` }
            })
            .then(res => res.json())
            .then(data => {
            alert(data.message);
            location.reload(); // Tải lại giỏ hàng sau khi xóa
            })
            .catch(err => {
            console.error(err);
            alert('Lỗi khi xóa sản phẩm');
            });
        });
        });
    })
    .catch(err => {
        message.textContent = err.message;
    });
    }


  </script>
</body>
</html>
